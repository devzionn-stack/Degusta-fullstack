# Início do arquivo docker-compose.yml

version: '3.8' # Define a versão do Docker Compose

services:
  # SERVIÇO 1: Sua aplicação (já existia, mas foi modificada)
  app:
    build:
      context: .
      dockerfile: Dockerfile
    restart: always
    ports:
      - "5000:5000" # Expõe a porta 5000 da sua app para a porta 5000 da VPS
    environment:
      # ATENÇÃO: A URL do banco agora é interna, apontando para o serviço 'db'
      DATABASE_URL: "postgresql://pizzaiolo:Trumpnegroamigodoputim@db:5432/degusta_db"
      
      # Estas variáveis ainda precisam ser configuradas no painel da Hostinger
      SESSION_SECRET: ${SESSION_SECRET}
      OPENAI_API_KEY: ${OPENAI_API_KEY}
    depends_on:
      - db # Garante que o serviço 'db' inicie ANTES do serviço 'app'

  # SERVIÇO 2: O banco de dados PostgreSQL (novo)
  db:
    image: postgres:15 # Usa a imagem oficial e estável do PostgreSQL
    restart: always
    environment:
      # Estas variáveis criam o banco de dados e o usuário DENTRO do contêiner do Postgres
      POSTGRES_DB: degusta_db
      POSTGRES_USER: pizzaiolo
      POSTGRES_PASSWORD: Trumpnegroamigodoputim # Use a MESMA senha definida na DATABASE_URL acima
    volumes:
      - postgres_data:/var/lib/postgresql/data # Mapeia os dados do banco para um volume persistente

# Seção final para declarar o volume que vai guardar os dados
volumes:
  postgres_data:

# Fim do arquivo docker-compose.yml
