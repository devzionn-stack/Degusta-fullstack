#!/bin/sh

# Script de inicialização para garantir que as migrações sejam aplicadas antes de iniciar a aplicação.

echo "--- Entrypoint: Iniciando processo de deploy ---"

# 1. Aplica as migrações do Prisma.
# O npx cuidará de encontrar e executar o Prisma.
echo "--- Entrypoint: Aplicando migrações do banco de dados... ---"
npx prisma migrate deploy

# Verifica o código de saída do comando anterior. Se falhou, exibe uma mensagem e sai.
if [ $? -ne 0 ]; then
  echo "--- Entrypoint: Falha ao aplicar as migrações do banco de dados. Abortando. ---"
  exit 1
fi

echo "--- Entrypoint: Migrações aplicadas com sucesso. ---"

# 2. Inicia a aplicação principal.
# O 'exec "$@"' executa o comando passado como argumento para este script (que será 'npm start').
echo "--- Entrypoint: Iniciando a aplicação principal... ---"
exec "$@"
